<ion-header class="ion-no-border">
    <ion-toolbar class="fondo-content">
        <ion-buttons slot="start">
            <ion-button (click)="regresar()">
                <ion-icon slot="start" name="chevron-back"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>
            <h3 style="font-weight: 700;">{{pedido.cliente.nombre}}</h3>
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>

    <!-- Cancelado -->
    <h2 *ngIf="pedido.cancelado_by_negocio">Pedido rechazado</h2>
    <ion-card *ngIf="pedido.cancelado_by_negocio">
        <ion-item lines="none">
            <ion-label color="medium" class="ion-text-wrap"><strong>Motivo:</strong> {{pedido.razon_cancelacion}}</ion-label>
        </ion-item>
    </ion-card>

    <!-- Calificar -->
    <div *ngIf="pedido.entregado && !pedido.cancelado_by_negocio">
        <h2>Calificación</h2>
        <ng-container *ngIf="pedido.calificacion; else calificacionTemplate">
            <ion-card>
                <ion-item lines="none">
                    <ion-thumbnail>
                        <img [src]="pedido.negocio.logo" />
                    </ion-thumbnail>
                    <ion-label color="medium">
                        <h2 style="margin-left: 0;">{{pedido.negocio.nombreNegocio}}</h2>
                        <p class="ion-text-wrap">{{pedido.calificacion.negocio.comentarios}}</p>
                        <p>
                            <app-stars style="margin: auto;" [calificacion]="pedido.calificacion.negocio.puntos" [readOnly]="true" (calficar)="repartidor.puntos = $event"></app-stars>
                        </p>
                    </ion-label>
                </ion-item>
                <ion-item lines="none">
                    <ion-thumbnail>
                        <img [src]="pedido.repartidor.foto" />
                    </ion-thumbnail>
                    <ion-label color="medium">
                        <h2 style="margin-left: 0;">{{pedido.repartidor.nombre}}</h2>
                        <p class="ion-text-wrap">{{pedido.calificacion.repartidor.comentarios}}</p>
                        <p>
                            <app-stars style="margin: auto;" [calificacion]="pedido.calificacion.repartidor.puntos" [readOnly]="true" (calficar)="repartidor.puntos = $event"></app-stars>
                        </p>
                    </ion-label>
                </ion-item>
            </ion-card>
        </ng-container>
        <ng-template #calificacionTemplate>
            <ion-card (click)="verCalificar()">
                <ion-item lines="none">
                    <ion-label color="medium">
                        Pendiente de calificación
                    </ion-label>
                </ion-item>
                <ion-item style="text-align: center;" lines="none" class="gradient--">
                    <ion-label color="light">Calificar</ion-label>
                </ion-item>
            </ion-card>
        </ng-template>


    </div>

    <!-- Detalles entrega -->
    <h2>Entrega</h2>
    <ion-card>
        <ion-item *ngIf="pedido.cliente.telefono" lines="none">
            <ion-label>{{pedido.cliente.nombre}}: {{pedido.cliente.telefono}}</ion-label>
        </ion-item>
        <ion-item lines="none">
            <ion-label class="ion-text-wrap" color="medium">{{pedido.cliente.direccion.direccion}}</ion-label>
        </ion-item>
    </ion-card>

    <!-- Lista productos -->
    <h2>Productos</h2>
    <ion-card>
        <ion-item style="--padding-start: 0; padding-top: 1rem;" *ngFor="let prod of pedido.productos" lines="none">
            <ion-grid class="ion-no-padding">
                <ion-row>
                    <ion-col size="4">
                        <ion-img [src]="prod.url" style="height: 100%; width: 100%; max-height: 7rem; object-fit: cover;" (ionImgWillLoad)="ionImgWillLoad($event)"></ion-img>
                    </ion-col>
                    <ion-col size="8">
                        <ion-item lines="none">
                            <ion-label class="ion-text-wrap">
                                <h2 style="margin-left: 0;">{{(prod.nombre.length > 25) ? (prod.nombre | slice:0:25) + '...' : prod.nombre}}</h2>
                                <h2 *ngIf="prod.precio" class="primario" style="margin-left: 0;">{{prod.precio | currency:'CAD':'symbol-narrow':'1.0-2'}}</h2>
                                <div *ngFor="let complemento of prod.complementos">
                                    <p style="color: var(--ion-color-medium)" *ngFor="let item of complemento.complementos">+ {{item.precio | currency:'CAD':'symbol-narrow':'1.0-2'}} / {{item.nombre}}</p>
                                </div>
                            </ion-label>
                            <ion-badge class="gradient--" mode="ios">{{prod.cantidad}}</ion-badge>
                        </ion-item>
                    </ion-col>
                </ion-row>
            </ion-grid>
        </ion-item>
        <ion-item style="text-align: center;" lines="none">
            <ion-label style="font-weight: 700;" color="primary">Total: {{pedido.total | currency:'CAD':'symbol-narrow':'1.0-2'}}</ion-label>
        </ion-item>
    </ion-card>
</ion-content>